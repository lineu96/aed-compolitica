---
title: Fundamentos de Análise Exploratória de Dados
subtitle:  | 
 | Conceitos e Aplicações
 | 
author: |
 |
 | Prof. Me. Lineu Alberto Cavazani de Freitas \vspace{-0.5cm}
date: ""
output:
  html_document:                    
    #toc: true                       
    #toc_depth: 3                    
    #toc_float:                      
    #  collapsed: true
    #  smooth_scroll: true
    #number_sections: true           
    #theme: default
    #spacelab
    #default,cerulean,journal,flatly,readable,spacelab,
    #united,cosmo,lumen,paper,sandstone,simplex,yeti
    
    highlight: textmate
    #default, tango, pygments, kate, monochrome, espresso, zenburn, haddock, and textmate
    #css: styles.css                
    fig_width: 7                    
    fig_height: 6                   
    fig_caption: true               
    fig_align: 'center'
    #code_folding: hide              
#    keep_md: true
---


---

# Encontro 3

## Análise exploratória na prática: revisando conceitos e extraindo informações de um conjunto de dados real com R.

Os comandos a seguir mostram diversas técnicas vistas em aula para análise exploratória de variáveis qualitativas e quantitativas por meio de tabelas, gráficos e medidas.

Os comandos são bastante básicos. Fica como tarefa aos interessados em linguagem R buscar maneiras de customizar os gráficos e tabelas e explorar ferramentas mais modernas para fazer a mesma análise proposta. Sugere-se fortemente a exploração de pacotes como dplyr e ggplot2.

```{r, eval=FALSE}
#-----------------------------------------------------------------------
rm(list = ls()) # Limpa o ambiente de trabalho do R, removendo todos os objetos anteriores.
#-----------------------------------------------------------------------

# --- Seção 1: Configuração Inicial e Carregamento dos Dados ---

# Leitura dos dados
dados <- read.csv("https://raw.githubusercontent.com/fernandomayer/data/master/milsa.csv") # Carrega o conjunto de dados "milsa.csv" diretamente de uma URL.

# Correção dos nomes das colunas
names(dados) <- c("funcionario", "estado_civil",
                  "instrucao", "filhos", "salario",
                  "anos", "meses", "regiao") # Renomeia as colunas para facilitar o entendimento e uso.

# Primeiras linhas
head(dados) # Exibe as primeiras 6 linhas do dataframe para uma inspeção inicial dos dados.

#---

# --- Seção 2: Análise Exploratória de Variáveis Qualitativas ---

dados$estado_civil # Acessa a coluna 'estado_civil' para visualização.

## 2.1. Tabelas de Frequência para Variáveis Qualitativas

### 2.1.1. Frequência Absoluta
table(dados$estado_civil) # Gera uma tabela de frequência absoluta para a variável 'estado_civil'.
tabela_ec_freq_abs <- table(dados$estado_civil) # Armazena a tabela de frequência absoluta em 'tabela_ec_freq_abs'.
tabela_ec_freq_abs # Exibe 'tabela_ec_freq_abs'.
sum(tabela_ec_freq_abs) # Soma as frequências para verificar o total de observações.

### 2.1.2. Frequência Relativa
prop.table(tabela_ec_freq_abs) # Calcula as proporções (frequências relativas) a partir de 'tabela_ec_freq_abs'.
tabela_ec_freq_rel <- prop.table(tabela_ec_freq_abs) # Armazena as frequências relativas em 'tabela_ec_freq_rel'.
tabela_ec_freq_rel # Exibe 'tabela_ec_freq_rel'.
sum(tabela_ec_freq_rel) # Soma as proporções para verificar se o total é 1 (ou próximo de 1).

### 2.1.3. Frequência Percentual
tabela_ec_freq_rel*100 # Converte as proporções de 'tabela_ec_freq_rel' em percentuais.
tabela_ec_freq_perc <- tabela_ec_freq_rel*100 # Armazena os percentuais em 'tabela_ec_freq_perc'.
tabela_ec_freq_perc # Exibe 'tabela_ec_freq_perc'.
sum(tabela_ec_freq_perc) # Soma os percentuais para verificar se o total é 100.

## 2.2. Gráficos para Variáveis Qualitativas

### 2.2.1. Gráficos de Barras Simples (plot)
plot(tabela_ec_freq_abs) # Gera um gráfico de barras simples usando a função 'plot' para frequências absolutas.
plot(tabela_ec_freq_rel) # Gera um gráfico de barras simples para frequências relativas.
plot(tabela_ec_freq_perc) # Gera um gráfico de barras simples para percentuais.

### 2.2.2. Gráficos de Barras (barplot)
barplot(tabela_ec_freq_abs) # Gera um gráfico de barras usando a função 'barplot' para frequências absolutas.
barplot(tabela_ec_freq_rel) # Gera um gráfico de barras para frequências relativas.
barplot(tabela_ec_freq_perc) # Gera um gráfico de barras para percentuais.

### 2.2.3. Gráficos de Barras Horizontais
barplot(tabela_ec_freq_abs, horiz=T) # Gera um gráfico de barras horizontais para frequências absolutas.
barplot(tabela_ec_freq_rel, horiz=T) # Gera um gráfico de barras horizontais para frequências relativas.
barplot(tabela_ec_freq_perc, horiz=T) # Gera um gráfico de barras horizontais para percentuais.

### 2.2.4. Gráficos de Pizza
pie(tabela_ec_freq_abs) # Gera um gráfico de pizza para frequências absolutas.
pie(tabela_ec_freq_rel) # Gera um gráfico de pizza para frequências relativas.
pie(tabela_ec_freq_perc) # Gera um gráfico de pizza para percentuais.

### 2.2.5. Gráficos de Barras Empilhadas (Usando "Truque")
# Cria uma tabela de frequência que, ao incluir uma coluna "vazia" (com um valor repetido para todas as observações),
# força a função `barplot()` a criar um gráfico de barras empilhadas para uma única variável qualitativa.
tabela_ec_dummy <- table(dados$estado_civil, rep('',36)) # 'rep('',36)' atua como uma segunda variável dummy.
barplot(tabela_ec_dummy) # Gera um gráfico de barras empilhadas, onde cada segmento representa uma categoria de estado civil.
barplot(tabela_ec_dummy, horiz = T) # Gera o mesmo gráfico, mas com barras horizontais empilhadas.

tabela_ec_dummy_prop <- prop.table(tabela_ec_dummy) # Calcula as proporções para 'tabela_ec_dummy'.
barplot(tabela_ec_dummy_prop) # Gera gráfico de barras empilhadas com proporções.
barplot(tabela_ec_dummy_prop, horiz = T) # Gera gráfico de barras horizontais empilhadas com proporções.

## 2.3. Organização de Tabelas de Frequência

# Cria um dataframe para organizar as tabelas de frequência de forma mais apresentável.
tabela_ec_final <- data.frame(estado_civil = names(tabela_ec_freq_abs), # Nomes das categorias.
                              freq = as.vector(tabela_ec_freq_abs), # Frequências absolutas.
                              freq_r = as.vector(tabela_ec_freq_rel)) # Frequências relativas.

tabela_ec_final # Exibe o dataframe inicial.
tabela_ec_final[3,1] <- "TOTAL" # Adiciona a linha "TOTAL" na primeira coluna.
tabela_ec_final[3,2] <- sum(tabela_ec_final$freq, na.rm = T) # Calcula e adiciona a soma das frequências absolutas.
tabela_ec_final[3,3] <- sum(tabela_ec_final$freq_r, na.rm = T) # Calcula e adiciona a soma das frequências relativas.
tabela_ec_final # Exibe o dataframe com a linha de total.

names(tabela_ec_final) # Exibe os nomes atuais das colunas.
names(tabela_ec_final) <- c("Estado civil",
                            "Freq. absoluta",
                            "Freq. Relativa") # Renomeia as colunas para melhor legibilidade.
tabela_ec_final # Exibe o dataframe final com os novos nomes.

#---
# --- Seção 3: Análise Exploratória de Variáveis Quantitativas ---

dados$salario # Acessa a coluna 'salario' para visualização.

## 3.1. Tabelas de Frequência para Variáveis Quantitativas (com Classes)

breaks <- seq(4,24,2) # Define os pontos de corte (quebras) para as classes de intervalo do salário.

classes <- cut(dados$salario, # Divide a variável 'salario' em intervalos (classes).
               breaks = breaks, # Utiliza os pontos de corte definidos.
               include.lowest = TRUE, # Define intervalos fechados à esquerda.
               right = FALSE) # Define intervalos abertos à direita.

table(classes) # Gera uma tabela de frequência para as classes de salário.
tabela_sal_classes_abs <- table(classes) # Armazena a tabela de frequência em 'tabela_sal_classes_abs'.
tabela_sal_classes_abs # Exibe 'tabela_sal_classes_abs'.
sum(tabela_sal_classes_abs) # Soma as frequências para verificar o total de observações.

prop.table(tabela_sal_classes_abs) # Calcula as proporções (frequências relativas) a partir de 'tabela_sal_classes_abs'.
tabela_sal_classes_rel <- prop.table(tabela_sal_classes_abs) # Armazena as frequências relativas em 'tabela_sal_classes_rel'.
tabela_sal_classes_rel # Exibe 'tabela_sal_classes_rel'.
sum(tabela_sal_classes_rel) # Soma as proporções para verificar se o total é 1.

tabela_sal_classes_rel*100 # Converte as proporções de 'tabela_sal_classes_rel' em percentuais.
tabela_sal_classes_perc <- tabela_sal_classes_rel*100 # Armazena os percentuais em 'tabela_sal_classes_perc'.
tabela_sal_classes_perc # Exibe 'tabela_sal_classes_perc'.
sum(tabela_sal_classes_perc) # Soma os percentuais para verificar se o total é 100.

## 3.2. Gráficos para Variáveis Quantitativas

### 3.2.1. Histograma e Densidade
tabela_sal_classes_abs # Exibe a tabela de frequência das classes de salário.

barplot(tabela_sal_classes_abs, space = 0) # Gera um gráfico de barras (histograma) das classes sem espaço entre as barras.
hist(dados$salario) # Gera um histograma padrão da variável 'salario'.
hist(dados$salario, probability = T) # Gera um histograma de densidade (com a área total igual a 1).

densidade <- density(dados$salario) # Estima a função de densidade de probabilidade para 'salario'.
plot(densidade) # Plota a curva de densidade estimada.

hist(dados$salario, probability = T) # Gera novamente o histograma de densidade.
lines(densidade) # Adiciona a curva de densidade ao histograma existente.

### 3.2.2. Boxplot
boxplot(dados$salario) # Gera um boxplot para a variável 'salario'.
boxplot(dados$salario, horizontal = T) # Gera um boxplot horizontal para 'salario'.

## 3.3. Organização de Tabelas de Frequência para Variáveis Quantitativas

# Cria um dataframe para organizar as tabelas de frequência para variáveis quantitativas.
tabela_sal_final <- data.frame(faixas= names(tabela_sal_classes_abs), # Nomes das faixas de salário.
                               freq = as.vector(tabela_sal_classes_abs), # Frequências absolutas das faixas.
                               freq_r = as.vector(tabela_sal_classes_rel)) # Frequências relativas das faixas.

tabela_sal_final # Exibe o dataframe inicial.
tabela_sal_final[11,1] <- "TOTAL" # Adiciona a linha "TOTAL" na primeira coluna (considerando 10 faixas + 1 para o total).
tabela_sal_final[11,2] <- sum(tabela_sal_final$freq, na.rm = T) # Calcula e adiciona a soma das frequências absolutas.
tabela_sal_final[11,3] <- sum(tabela_sal_final$freq_r, na.rm = T) # Calcula e adiciona a soma das frequências relativas.
tabela_sal_final # Exibe o dataframe com a linha de total.

names(tabela_sal_final) # Exibe os nomes atuais das colunas.
names(tabela_sal_final) <- c("Faixas",
                             "Freq. absoluta",
                             "Freq. Relativa") # Renomeia as colunas para melhor legibilidade.
tabela_sal_final # Exibe o dataframe final com os novos nomes.

#---
# --- Seção 4: Medidas Resumo (Posição e Dispersão) ---

dados$salario # Acessa a coluna 'salario' para visualização.

## 4.1. Medidas de Posição (Tendência Central e Separatrizes)

### 4.1.1. Média Aritmética
sum(dados$salario)/length(dados$salario) # Calcula a média do salário manualmente.
mean(dados$salario) # Calcula a média do salário usando a função 'mean()'.

### 4.1.2. Mediana
median(dados$salario) # Calcula a mediana do salário.

### 4.1.3. Quartis e Decis
quantile(dados$salario) # Calcula os quartis (0%, 25%, 50%, 75%, 100%) do salário.
quantile(dados$salario, seq(0,1,0.1)) # Calcula os decis de 0% a 100% (a cada 10%).
quantile(dados$salario)[4] - quantile(dados$salario)[2] # Calcula a Amplitude Interquartil (Q3 - Q1).

## 4.2. Medidas de Dispersão (Variabilidade)

### 4.2.1. Amplitude Total
min(dados$salario) # Encontra o valor mínimo do salário.
max(dados$salario) # Encontra o valor máximo do salário.
range(dados$salario) # Retorna o mínimo e o máximo do salário.
max(dados$salario) - min(dados$salario) # Calcula a amplitude (máximo - mínimo).
diff(range(dados$salario)) # Outra forma de calcular a amplitude total.

### 4.2.2. Desvios Absolutos
dados$salario - mean(dados$salario) # Calcula os desvios de cada salário em relação à média.
dados$salario - median(dados$salario) # Calcula os desvios de cada salário em relação à mediana.

da_media <- abs(dados$salario - mean(dados$salario)) # Calcula o desvio absoluto em relação à média.
da_mediana <- abs(dados$salario - median(dados$salario)) # Calcula o desvio absoluto em relação à mediana.

### 4.2.3. Desvio Médio Absoluto (DMA)
mean(da_media) # Calcula o Desvio Médio Absoluto (DMA) em relação à média.
mean(da_mediana) # Calcula o Desvio Médio Absoluto (DMA) em relação à mediana.

### 4.2.4. Variância e Desvio Padrão
var(dados$salario) # Calcula a variância do salário.
sqrt(var(dados$salario)) # Calcula o desvio padrão a partir da raiz quadrada da variância.
sd(dados$salario) # Calcula o desvio padrão do salário usando a função 'sd()'.

### 4.2.5. Coeficiente de Variação (CV)
sd(dados$salario)/mean(dados$salario) # Calcula o coeficiente de variação.

### 4.2.6. Escores Z (Padronização)
(dados$salario - mean(dados$sal)/sd(dados$salario)) # Calcula os escores Z.
scale(dados$salario) # Função mais eficiente para calcular os escores Z.
escore <- scale(dados$salario) # Armazena os escores Z em 'escore'.
mean(escore) # Calcula a média dos escores Z (deve ser aproximadamente 0).
sd(escore) # Calcula o desvio padrão dos escores Z (deve ser aproximadamente 1).

### 4.2.7. Entropia de Shannon (Variabilidade para Qualitativas)
dados$instrucao # Acessa a coluna 'instrucao'.
tabela_inst_freq_abs <- table(dados$instrucao) # Tabela de frequência para 'instrucao'.
pi <- prop.table(tabela_inst_freq_abs) # Proporções (frequências relativas).
log_pi <- log(pi) # Logaritmo natural das proporções.
h <- -(sum(pi*log_pi)) # Calcula a entropia de Shannon, uma medida de variabilidade para variáveis qualitativas.
h # Exibe o valor da entropia.

#---
# --- Seção 5: Análises Bivariadas (Explorando Relações entre Variáveis) ---

dados$estado_civil # Acessa a coluna 'estado_civil'.
dados$instrucao # Acessa a coluna 'instrucao'.

## 5.1. Tabelas de Contingência (Qualitativa vs. Qualitativa)

table(dados$estado_civil, dados$instrucao) # Tabela de contingência entre 'estado_civil' e 'instrucao'.
table(dados$instrucao, dados$estado_civil) # Tabela de contingência com as variáveis invertidas.

### 5.1.1. Tabela de Frequência Absoluta
tabela_contingencia_abs <- table(dados$estado_civil,
                                 dados$instrucao) # Armazena a tabela de contingência em 'tabela_contingencia_abs'.
tabela_contingencia_abs # Exibe 'tabela_contingencia_abs'.
sum(tabela_contingencia_abs) # Soma total das observações na tabela de contingência.

addmargins(tabela_contingencia_abs) # Adiciona somas de linha e coluna (margens) à 'tabela_contingencia_abs'.
t(tabela_contingencia_abs) # Transpõe a tabela (inverte linhas e colunas).

### 5.1.2. Tabela de Proporção Geral
prop.table(tabela_contingencia_abs) # Calcula as proporções em relação ao total geral da tabela.
tabela_contingencia_rel <- prop.table(tabela_contingencia_abs) # Armazena as proporções gerais em 'tabela_contingencia_rel'.
tabela_contingencia_rel # Exibe 'tabela_contingencia_rel'.
sum(tabela_contingencia_rel) # Soma as proporções para verificar o total (deve ser 1).
addmargins(tabela_contingencia_rel) # Adiciona somas de linha e coluna às proporções gerais.
t(tabela_contingencia_rel) # Transpõe a tabela de proporções gerais.

### 5.1.3. Tabela de Proporção por Linha
prop.table(tabela_contingencia_abs, margin = 1) # Calcula as proporções por linha (soma de cada linha = 1).
tabela_contingencia_linha <- prop.table(tabela_contingencia_abs, margin = 1) # Armazena as proporções por linha em 'tabela_contingencia_linha'.
tabela_contingencia_linha # Exibe 'tabela_contingencia_linha'.
addmargins(tabela_contingencia_linha) # Adiciona somas de linha e coluna (as somas das linhas serão 1).
t(tabela_contingencia_linha) # Transpõe a tabela de proporções por linha.

### 5.1.4. Tabela de Proporção por Coluna
prop.table(tabela_contingencia_abs, margin = 2) # Calcula as proporções por coluna (soma de cada coluna = 1).
tabela_contingencia_coluna <- prop.table(tabela_contingencia_abs, margin = 2) # Armazena as proporções por coluna em 'tabela_contingencia_coluna'.
tabela_contingencia_coluna # Exibe 'tabela_contingencia_coluna'.
addmargins(tabela_contingencia_coluna) # Adiciona somas de linha e coluna (as somas das colunas serão 1).

## 5.2. Gráficos para Análises Bivariadas (Qualitativa vs. Qualitativa)

tabela_contingencia_abs # Exibe a tabela de contingência original.

barplot(tabela_contingencia_abs, beside = F, legend.text = T) # Gráfico de barras empilhadas para 'tabela_contingencia_abs' com legenda.
barplot(t(tabela_contingencia_abs), beside = F, legend.text = T) # Gráfico de barras empilhadas com a tabela transposta.

barplot(tabela_contingencia_abs, beside = T, legend.text = T) # Gráfico de barras agrupadas para 'tabela_contingencia_abs' com legenda.
barplot(t(tabela_contingencia_abs), beside = T, legend.text = T) # Gráfico de barras agrupadas com a tabela transposta.

barplot(t(tabela_contingencia_linha), legend.text = T) # Gráfico de barras para proporções por linha.
barplot(tabela_contingencia_coluna, legend.text = T) # Gráfico de barras para proporções por coluna.

## 5.3. Medida de associação para qualitativas: Qui-Quadrado

tabela_contingencia_abs # Exibe a tabela de contingência original.
tabela_contingencia_margens <- addmargins(tabela_contingencia_abs) # Tabela de contingência com as somas marginais.
tabela_contingencia_margens # Exibe a tabela com as margens.

# Calcula as frequências esperadas para o teste Qui-quadrado de independência.
# (linha total * coluna total) / total geral
esperados <- (tabela_contingencia_margens[1:2,4] %*% t(tabela_contingencia_margens[3,1:3]))/sum(tabela_contingencia_abs)
# Calcula a estatística Qui-quadrado (soma do quadrado da diferença entre observado e esperado, dividido pelo esperado).
sum(((tabela_contingencia_abs - esperados)^2)/(esperados)) # Não é o teste qui-quadrado completo, mas o cálculo da estatística.
# Para realizar o teste de qui-quadrado completo, use 'chisq.test(tabela_contingencia_abs)'.

## 5.4. Correlação (Quantitativa vs. Quantitativa)

cor(dados$salario, dados$anos) # Calcula a correlação de Pearson entre 'salario' e 'anos' (padrão).
cor(dados$salario, dados$anos, method = "pearson") # Especifica o método de Pearson para correlação linear.
cor(dados$salario, dados$anos, method = "spearman") # Calcula a correlação de Spearman (não-paramétrica, baseada em ranks).
cor(dados$salario, dados$anos, method = "kendall") # Calcula a correlação de Kendall (não-paramétrica, baseada em concordância/discordância).

plot(salario ~ anos, data = dados) # Cria um gráfico de dispersão de 'salario' em função de 'anos'.
lm(salario ~ anos, data = dados) # Ajusta um modelo de regressão linear simples.
coeficientes <- lm(salario ~ anos, data = dados) # Armazena os resultados do modelo de regressão.
abline(coeficientes, col = 2) # Adiciona a linha de regressão ao gráfico de dispersão (em vermelho).

## 5.5. Análise Comparativa de Variáveis Quantitativas por Grupo (Quantitativa vs. Qualitativa)

### 5.5.1. Medidas Resumo por Grupo (tapply)
# Aplica uma função (FUN) a subconjuntos de um vetor (X), definidos por um fator (INDEX).
tapply(X = dados$salario, # Variável quantitativa de interesse.
       INDEX = dados$instrucao, # Variável categórica para agrupar os dados.
       FUN = mean) # Calcula a média do salário para cada nível de 'instrucao'.

tapply(X = dados$salario,
       INDEX = dados$instrucao,
       FUN = sd) # Calcula o desvio padrão do salário para cada nível de 'instrucao'.

tapply(X = dados$salario,
       INDEX = dados$instrucao,
       FUN = summary) # Gera um sumário estatístico completo do salário para cada nível de 'instrucao'.

### 5.5.2. Boxplots Comparativos
boxplot(salario~instrucao, data = dados) # Gera boxplots comparativos do salário por nível de instrução.

### 5.5.3. Histograma e Densidade por Grupo
grau1 <- subset(dados, instrucao == "1o Grau") # Cria um subconjunto de dados para '1o Grau'.
grau2 <- subset(dados, instrucao == "2o Grau") # Cria um subconjunto de dados para '2o Grau'.
grau3 <- subset(dados, instrucao == "Superior") # Cria um subconjunto de dados para 'Superior'.

par(mfrow = c(1,3)) # Define o layout da área de plotagem para 1 linha e 3 colunas.
hist(grau1$salario) # Histograma do salário para o grupo "1o Grau".
hist(grau2$salario) # Histograma do salário para o grupo "2o Grau".
hist(grau3$salario) # Histograma do salário para o grupo "Superior".

plot(density(grau1$salario)) # Plota a curva de densidade do salário para "1o Grau".
plot(density(grau2$salario)) # Plota a curva de densidade do salário para "2o Grau".
plot(density(grau3$salario)) # Plota a curva de densidade do salário para "Superior".

par(mfrow = c(1,1)) # Reseta o layout da área de plotagem para uma única figura.
plot(density(grau1$salario), xlim = c(0,30)) # Plota a densidade do "1o Grau" com limites x definidos.
lines(density(grau2$salario), col= 2) # Adiciona a densidade do "2o Grau" (em vermelho) ao gráfico existente.
lines(density(grau3$salario), col = 4) # Adiciona a densidade do "Superior" (em azul) ao gráfico existente.
```

<div class="tocify-extend-page" data-unique="tocify-extend-page" style="height: 0;"></div>